<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title th:text="#{faq.title}">자주 묻는 질문</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            background: #f7fafd;
        }
        .faq-container {
            margin: 0 auto;
        }
        .faq-title {
            font-weight: 700;
            color: #1976d2;
            margin-bottom: 2rem;
            letter-spacing: -1px;
        }
        .nav-tabs .nav-link {
            color: #1976d2;
            font-weight: 500;
            border-radius: 1.5rem 1.5rem 0 0;
            background: #f0f6fb;
            margin-right: 4px;
            border: none;
        }
        .nav-tabs .nav-link.active {
            background: #fff;
            color: #1976d2;
            border-bottom: 2px solid #1976d2;
            font-weight: 700;
        }
        .faq-add-btn {
            display: inline-block;
            margin-bottom: 1.5rem;
            background: #1976d2;
            color: #fff !important;
            border-radius: 2rem;
            padding: 0.5rem 1.5rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(25, 118, 210, 0.08);
            border: none;
            transition: background 0.2s;
        }
        .faq-add-btn:hover {
            background: #125ea7;
            color: #fff;
        }
        .accordion {
            border-radius: 1.2rem;
            box-shadow: 0 2px 16px rgba(25, 118, 210, 0.07);
            background: #fff;
            padding: 0.5rem 0.5rem;
        }
        .accordion-item {
            border: none;
            border-radius: 1rem !important;
            margin-bottom: 0.7rem;
            overflow: hidden;
            background: #fafdff;
            box-shadow: 0 1px 6px rgba(25, 118, 210, 0.04);
        }
        .accordion-button {
            background: #fff;
            border: none;
            border-radius: 1rem !important;
            font-weight: 600;
            font-size: 1.08rem;
            color: #1976d2;
            box-shadow: none;
            padding: 1rem 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.7rem;
        }
        .accordion-button:not(.collapsed) {
            background: #e3f0fc;
            color: #125ea7;
        }
        .faq-category-badge {
            background: #e3f0fc;
            color: #1976d2;
            border-radius: 1rem;
            font-size: 0.92rem;
            font-weight: 600;
            padding: 0.2rem 0.9rem;
            margin-right: 0.7rem;
        }
        .accordion-body {
            background: #fafdff;
            border-radius: 0 0 1rem 1rem;
            color: #333;
            font-size: 1.02rem;
            padding: 1.1rem 1.5rem;
        }
        .pagination .page-link {
            color: #1976d2;
            border-radius: 1rem !important;
            margin: 0 2px;
            border: none;
            background: #f0f6fb;
            font-weight: 500;
        }
        .pagination .page-item.active .page-link,
        .pagination .page-link:focus {
            background: #1976d2;
            color: #fff;
            border: none;
        }
        .pagination .page-item.disabled .page-link {
            color: #b0b8c1;
            background: #f0f6fb;
        }
        @media (max-width: 600px) {
            .faq-container { padding: 0 0.5rem; }
            .faq-title { font-size: 1.3rem; }
            .accordion-button { font-size: 0.98rem; padding: 0.8rem 0.7rem; }
            .accordion-body { font-size: 0.97rem; padding: 0.8rem 0.7rem; }
        }
    </style>
</head>
<body>
    <div th:replace="fragments/header :: header"></div>

    <div class="container faq-container mt-5 mb-5">
        <h2 class="faq-title" th:text="#{faq.title}">자주 묻는 질문</h2>
        <!-- ① 분류 탭 -->
        <ul class="nav nav-tabs mb-3 d-flex" id="faqTabs">
            <li class="nav-item flex-fill"><button type="button" class="nav-link w-100" th:classappend="${currentCategory == 'all'} ? 'active'" onclick="goToCategory('all')" th:text="#{faq.category.all}">전체</button></li>
            <li class="nav-item flex-fill"><button type="button" class="nav-link w-100" th:classappend="${currentCategory == '병원이용안내'} ? 'active'" onclick="goToCategory('병원이용안내')" th:text="#{faq.category.hospital.guide}">병원이용안내</button></li>
            <li class="nav-item flex-fill"><button type="button" class="nav-link w-100" th:classappend="${currentCategory == '증명서발급'} ? 'active'" onclick="goToCategory('증명서발급')" th:text="#{faq.category.certificate}">증명서발급</button></li>
            <li class="nav-item flex-fill"><button type="button" class="nav-link w-100" th:classappend="${currentCategory == '홈페이지이용'} ? 'active'" onclick="goToCategory('홈페이지이용')" th:text="#{faq.category.website}">홈페이지이용</button></li>
            <li class="nav-item flex-fill"><button type="button" class="nav-link w-100" th:classappend="${currentCategory == '기타'} ? 'active'" onclick="goToCategory('기타')" th:text="#{faq.category.etc}">기타</button></li>
        </ul>
        <a th:href="@{/guide/faqWrite}" sec:authorize="hasRole('A')" class="faq-add-btn" th:text="#{faq.add}">FAQ 추가하기</a>
        <!-- ② FAQ 리스트 -->
        <div class="accordion" id="accordionExample">
            <div th:if="${faqPage.content.size() == 0}"
                 class="text-center py-5"
                 style="color:#1976d2; font-weight:600; font-size:1.1rem; background:#fafdff; border-radius:1rem; box-shadow:0 1px 6px rgba(25,118,210,0.04);"
                 th:text="#{faq.empty}">
                등록된 FAQ가 없습니다.
            </div>

            <div class="accordion-item" th:each="faq : ${faqPage.content}" th:unless="${faqPage.content.size() == 0}">
                <h2 class="accordion-header" th:attr="id='heading' + ${faq.faqId}">
                    <button class="accordion-button collapsed" type="button"
                            data-bs-toggle="collapse"
                            th:attr="data-bs-target='#collapse' + ${faq.faqId}"
                            aria-expanded="false"
                            th:attrappend="aria-controls='collapse' + ${faq.faqId}">
                    <span class="faq-category-badge" th:switch="${faq.faqCategory}">
                        <span th:case="'병원이용안내'" th:text="#{faq.category.hospital.guide}">병원이용안내</span>
                        <span th:case="'증명서발급'" th:text="#{faq.category.certificate}">증명서발급</span>
                        <span th:case="'홈페이지이용'" th:text="#{faq.category.website}">홈페이지이용</span>
                        <span th:case="'기타'" th:text="#{faq.category.etc}">기타</span>
                        <span th:case="*" th:text="${faq.faqCategory}">기타</span>
                    </span>
                        <span th:text="${faq.title}">제목</span>
                    </button>
                </h2>

                <div class="accordion-collapse collapse"
                     th:attr="id='collapse' + ${faq.faqId}"
                     th:attrappend="aria-labelledby='heading' + ${faq.faqId}"
                     data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <span th:utext="${faq.content}">답변 내용</span>
                    </div>

                    <div class="mt-3" sec:authorize="hasRole('A')">
                        <form th:action="@{/guide/faqUpdate/{id}(id=${faq.faqId})}" method="get" style="display:inline;">
                            <button type="submit" class="btn btn-sm btn-warning" th:text="#{faq.edit}">수정</button>
                        </form>
                        <form th:action="@{/guide/faqDelete/{id}(id=${faq.faqId})}" method="post" style="display:inline;"
                              onsubmit="return confirm('정말 삭제하시겠습니까?');">
                            <button type="submit" class="btn btn-sm btn-danger" th:text="#{delete}">삭제</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- 페이지네이션 -->
        <nav>
            <ul class="pagination justify-content-center pt-3">
                <li class="page-item" th:classappend="${faqPage.first} ? 'disabled'">
                    <a class="page-link" th:href="@{/guide/faq(category=${currentCategory}, page=${faqPage.number - 1})}" th:text="#{faq.pagination.previous}">이전</a>
                </li>
                <li class="page-item" th:each="i : ${#numbers.sequence(0, faqPage.totalPages - 1)}"
                    th:if="${i >= 0}"
                    th:classappend="${i == faqPage.number} ? 'active'">
                    <a class="page-link" th:href="@{/guide/faq(category=${currentCategory}, page=${i})}" th:text="${i + 1}">1</a>
                </li>
                <li class="page-item" th:classappend="${faqPage.last} ? 'disabled'">
                    <a class="page-link" th:href="@{/guide/faq(category=${currentCategory}, page=${faqPage.number + 1})}" th:text="#{faq.pagination.next}">다음</a>
                </li>
            </ul>
        </nav>
    </div>

    <div th:replace="fragments/footer :: footer"></div>
</body>
<!-- 카테고리 필터, 한 번에 한 항목만 열리게 하는 스크립트 -->
<script>
    function goToCategory(category) {
        const url = `/guide/faq?category=` + encodeURIComponent(category) + `&page=0`;
        window.location.href = url;
    }

    // 아코디언: 한 번에 하나만 열리고, 이미 열린 것을 다시 클릭하면 닫히게 (Bootstrap 기본 + JS)
    document.addEventListener('DOMContentLoaded', function () {
        const accordion = document.getElementById('accordionExample');

        accordion.querySelectorAll('.accordion-button').forEach(function (button) {
            const targetId = button.getAttribute('data-bs-target');
            const target = document.querySelector(targetId);

            button.addEventListener('click', function (e) {
                e.preventDefault();

                const isShown = target.classList.contains('show');

                // 다른 패널 닫기
                accordion.querySelectorAll('.accordion-collapse.show').forEach(function (openItem) {
                    if (openItem !== target) {
                        bootstrap.Collapse.getOrCreateInstance(openItem).hide();
                    }
                });

                // 현재 패널 토글
                if (isShown) {
                    bootstrap.Collapse.getOrCreateInstance(target).hide();
                } else {
                    bootstrap.Collapse.getOrCreateInstance(target).show();
                }
            });
        });
    });
</script>
</html>