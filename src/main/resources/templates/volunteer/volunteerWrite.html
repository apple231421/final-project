<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="#{volunteer.write.title}">봉사활동 프로그램 작성</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!--    html 양식으로 글 작성하게 해주는 스크립트-->
    <script src="https://cdn.tiny.cloud/1/mktlb20x7afe52w9skphx1w443hawazmj76tgnrvwzl7a606/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <script th:inline="javascript">
        let msgVolunteerContent = [[#{volunteer.update.alert.content}]];
        tinymce.init({
            selector: '#content',
            language: 'ko',
            language_url: '/js/notice_ko.js', // 한국어 설정이 필요하면 유지
            height: 400,
            plugins: 'link lists code table',
            toolbar: 'undo redo | bold italic underline | alignleft aligncenter alignright | bullist numlist | code table',
            branding: false,
            promotion: false,
            setup: function (editor) {
                document.querySelector('form').addEventListener('submit', function (e) {
                    const content = tinymce.get('content').getContent({ format: 'text' }).trim();
                    if (!content) {
                        alert(msgVolunteerContent);
                        e.preventDefault();
                        tinymce.get('content').focus();
                    }
                });
            }
        });
    </script>
    <style>
        body {
          padding-top: 70px;
        }
    </style>
</head>
<body>
    <div th:replace="fragments/header :: header"></div>

    <div class="container mt-5 mb-5">
        <h2 class="mb-4" th:text="#{volunteer.write.title}">봉사활동 프로그램 작성</h2>
        <form th:action="@{/volunteer/volunteerWrite}" th:object="${volunteerForm}" method="post" enctype="multipart/form-data">
            <!--        title input형태-->
            <div class="mb-3">
                <label for="title" class="form-label" th:text="#{volunteer.update.label.title}">제목</label>
                <input type="text" th:field="*{title}" class="form-control" id="title" required >
            </div>
            <!--        content textarea 형태-->
            <div class="mb-3">
                <label for="content" class="form-label" th:text="#{volunteer.update.label.content}">내용</label>
                <textarea th:field="*{content}" class="form-control" id="content" name="content" ></textarea>
            </div>
            <!--        applyStartTime, applyEndTime 달력형태-->
            <div class="mb-3">
                <label for="applyStartTime" class="form-label" th:text="#{volunteer.update.label.applyStartTime}">신청 시작일</label>
                <input type="datetime-local" th:field="*{applyStartTime}" class="form-control" id="applyStartTime" required >
            </div>
            <div class="mb-3">
                <label for="applyEndTime" class="form-label" th:text="#{volunteer.update.label.applyEndTime}">신청 마감일</label>
                <input type="datetime-local" th:field="*{applyEndTime}" class="form-control" id="applyEndTime" required >
            </div>
            <!--        applyCount hidden형태, maxApplyCount input형태-->
            <input type="hidden" th:field="*{applyCount}" value="0" />

            <!--        status select형태-->
            <select th:field="*{status}" class="form-select">
                <option th:each="status : ${T(THE_JEONG.Hospital.constant.VolunteerStatus).values()}"
                        th:value="${status}"
                        th:text="#{'volunteer.status.' + ${status.name()}}">
                </option>
            </select>
            <!--        maxApplyCount input형태-->
            <div class="mb-3">
                <label for="maxApplyCount" class="form-label" th:text="#{volunteer.update.label.maxApplyCount}">최대 신청 인원</label>
                <input type="number" th:field="*{maxApplyCount}" class="form-control" id="maxApplyCount"
                       min="1" value="1" required >
            </div>
            <!--        file input형태-->
            <div class="mb-3">
                <label for="file" class="form-label" th:text="#{volunteer.update.label.file}">첨부파일</label>
                <input type="file" th:field="*{file}" class="form-control" id="file">
            </div>
            <button type="submit" class="btn btn-primary" th:text="#{volunteer.update.submit}"
                    id="submitBtn">등록하기</button>
        </form>

    </div>

    <div th:replace="fragments/footer :: footer"></div>
    <!-- 신청기간, 신청인원 유효성 검사 스크립트 -->
    <script th:inline="javascript">
        // 다국어 처리 메시지
        let msgVolunteerUpdateDate = [[#{volunteer.update.msg.date}]];
        let msgVolunteerUpdateMax1 = [[#{volunteer.update.msg.max1}]];

        document.getElementById('submitBtn').addEventListener('click', function (e) {
            const start = document.getElementById('applyStartTime').value;
            const end = document.getElementById('applyEndTime').value;

            if (start && end && new Date(end) < new Date(start)) {
                alert(msgVolunteerUpdateDate);
                e.preventDefault(); // 폼 제출 막기
            }

            const maxApplyCountInput = document.getElementById('maxApplyCount');
            const maxApplyCount = parseInt(maxApplyCountInput.value, 10);

            if (isNaN(maxApplyCount) || maxApplyCount < 1) {
                alert(msgVolunteerUpdateMax1);
                maxApplyCountInput.focus();
                e.preventDefault(); // 폼 제출 막기
                return;
            }
        });
    </script>
</body>
</html>