<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="#{medical.certificate.title}">진단서</title>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Nanum Gothic', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
      color: #333;
    }

    .container {
      max-width: 800px;
      margin: 30px auto;
      padding: 20px;
      background-color: #fff;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }

    .header {
      text-align: center;
      font-size: 30px;
      font-weight: 700;
      margin-bottom: 40px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 700;
      margin-top: 30px;
      border-bottom: 2px solid #333;
      padding-bottom: 5px;
    }

    .form-row {
      margin-bottom: 15px;
    }

    .form-row label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
    }

    .form-row input, .form-row textarea {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    .form-row textarea {
      height: 100px;
    }

    .form-group {
      display: flex;
      justify-content: space-between;
    }

    .form-group .input-half {
      width: 48%;
    }

    .footer {
      margin-top: 40px;
      font-size: 14px;
      text-align: center;
      color: #777;
    }

    .btn-group {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 30px;
    }

    .alert-info {
      background-color: #e9f7fc;
      border: 1px solid #b3e5fc;
      padding: 10px 15px;
      border-radius: 5px;
      font-size: 15px;
      color: #31708f;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1 th:text="#{medical.certificate.header}">진 단 서</h1>
  </div>

  <form action="/doctors/submitMedicalCertificate" method="POST">
    <input type="hidden" name="reservationId" th:value="${reservation.id}">

    <!-- 안내 메시지 -->
    <div class="alert-info" th:if="${diagnosis == null}" th:text="#{medical.certificate.alert.empty}">
      아직 작성되지 않은 진단서입니다. 아래 항목을 모두 입력한 뒤 제출해 주세요.
    </div>
    <div class="alert-info" th:if="${diagnosis != null}" th:text="#{medical.certificate.alert.exist}">
      이 예약에 작성된 진단서가 있습니다. 내용을 수정할 수 있습니다.
    </div>

    <!-- 환자 정보 -->
    <div class="section-title" th:text="#{medical.certificate.section.patient}">1. 환자 정보</div>
    <div class="form-row">
      <label th:text="#{medical.certificate.patient.name}">환자 성명</label>
      <input type="text" th:value="${user.name}" readonly>
    </div>
    <div class="form-group">
      <div class="input-half">
        <label th:text="#{medical.certificate.patient.gender}">성별</label>
        <input type="text" th:value="${user.gender == 'M' ? #messages.msg('medical.certificate.patient.gender.male') : #messages.msg('medical.certificate.patient.gender.female')}" readonly>
      </div>
      <div class="input-half">
        <label th:text="#{medical.certificate.patient.birth}">생년월일</label>
        <input type="text" th:value="${user.birthDate}" readonly>
      </div>
    </div>
    <div class="form-row">
      <label th:text="#{medical.certificate.patient.address}">주소</label>
      <input type="text" th:value="${user.address}" readonly>
    </div>
    <div class="form-row">
      <label th:text="#{medical.certificate.patient.phone}">전화번호</label>
      <input type="text" th:value="${user.phone}" readonly>
    </div>

    <!-- 진단 정보 -->
    <div class="section-title" th:text="#{medical.certificate.section.diagnosis}">2. 진단 정보</div>
    <div class="form-row">
      <label th:text="#{medical.certificate.diagnosis}">진단명</label>
      <textarea name="diagnosis" th:placeholder="#{medical.certificate.diagnosis.placeholder}" th:text="${diagnosis?.diagnosis}" required></textarea>
    </div>

    <!-- 치료 정보 -->
    <div class="section-title" th:text="#{medical.certificate.section.treatment}">3. 치료 내용</div>
    <div class="form-row">
      <label th:text="#{medical.certificate.treatment}">치료 방법</label>
      <textarea name="treatment" th:placeholder="#{medical.certificate.treatment.placeholder}" th:text="${diagnosis?.treatment}" required></textarea>
    </div>
    <div class="form-row">
      <label th:text="#{medical.certificate.treatment.period}">치료 기간</label>
      <input type="text" name="treatmentPeriod" th:placeholder="#{medical.certificate.treatment.period.placeholder}" th:value="${diagnosis?.treatmentPeriod}" required>
    </div>

    <!-- 진단 기간 -->
    <div class="section-title" th:text="#{medical.certificate.section.diagnosis.period}">4. 진단 기간</div>
    <div class="form-row">
      <label th:text="#{medical.certificate.diagnosis.period}">진단 기간</label>
      <input type="date" name="diagnosisPeriod" th:value="${diagnosis?.diagnosisPeriod}" required>
    </div>

    <!-- 의사 소견 -->
    <div class="section-title" th:text="#{medical.certificate.section.opinion}">5. 의사의 소견</div>
    <div class="form-row">
      <label th:text="#{medical.certificate.opinion}">의사의 소견</label>
      <textarea name="doctorOpinion" th:placeholder="#{medical.certificate.opinion.placeholder}" th:text="${diagnosis?.doctorOpinion}" required></textarea>
    </div>

    <!-- 버튼 그룹 -->
    <div class="btn-group" th:if="${reservation.state.name() != 'D' and reservation.state.name() != 'C'}">
      <button type="submit" class="btn btn-primary"
              name="state"
              value="I"
              th:text="${diagnosis == null ? #messages.msg('medical.certificate.button.write') : #messages.msg('medical.certificate.button.edit')}"
              onclick="return confirm([[#{medical.certificate.confirm.submit}]]);"></button>

      <button type="submit" class="btn btn-danger"
              name="state"
              value="C"
              onclick="return confirm([[#{medical.certificate.confirm.cancel}]]);"
              th:text="#{medical.certificate.button.cancel}" formnovalidate>예약 취소</button>

      <button type="submit" class="btn btn-success"
              name="state"
              value="D"
              th:if="${reservation.state.name() != 'R'}"
              onclick="return confirm([[#{medical.certificate.confirm.done}]]);"
              th:text="#{medical.certificate.button.done}">진료 완료</button>
    </div>

    <!-- 완료 상태 메시지 -->
    <div th:if="${reservation.state.name() == 'D'}" class="text-center mt-4">
      <p class="text-success fw-bold" th:text="#{medical.certificate.state.done}">이 진료는 이미 완료되었습니다.</p>
    </div>

    <div th:if="${reservation.state.name() == 'C'}" class="text-center mt-4">
      <p class="text-danger fw-bold" th:text="#{medical.certificate.state.cancel}">이 예약은 취소된 상태입니다. 진단서를 작성하거나 수정할 수 없습니다.</p>
    </div>
  </form>
</div>

</body>
</html>
