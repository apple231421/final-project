<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="#{doctors.reservation_list.title}">진료 예약 목록</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-light">
<div th:replace="fragments/header :: header"></div>
<div class="container" style="margin-top: 150px !important;">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0" th:text="#{doctors.reservation_list.my}">나의 진료 예약 목록</h2>
    <a href="/" class="btn btn-outline-secondary" th:text="#{doctors.reservation_list.home}">홈으로</a>
  </div>

  <!-- 검색 폼 -->
  <form method="get" th:action="@{/doctors/reservationList}" class="d-flex mb-4">
    <input type="date" name="searchDate" class="form-control me-2" th:placeholder="#{doctors.reservation_list.search.date}" placeholder="날짜 검색">
    <input type="text" name="searchName" class="form-control me-2" th:placeholder="#{doctors.reservation_list.search.name}" placeholder="환자 이름 검색">
    <button type="submit" class="btn btn-primary" th:text="#{doctors.reservation_list.search.button}">검색</button>
  </form>

  <!-- 오류 메시지 -->
  <div th:if="${error}" class="alert alert-danger">
    <span th:text="${error}"></span>
  </div>

  <!-- 예약이 없을 때 -->
  <div th:if="${#lists.isEmpty(reservations)}" class="alert alert-warning text-center shadow-sm">
    <span th:text="#{doctors.reservation_list.no.data}">현재 등록된 진료 예약이 없습니다.</span>
  </div>

  <!-- 예약 목록 -->
  <div th:unless="${#lists.isEmpty(reservations)}" class="table-responsive shadow-sm rounded">
    <table class="table table-hover align-middle">
      <thead class="table-primary text-center">
      <tr>
        <th scope="col" th:text="#{doctors.reservation_list.table.date}">날짜</th>
        <th scope="col" th:text="#{doctors.reservation_list.table.time}">시간</th>
        <th scope="col" th:text="#{doctors.reservation_list.table.name}">환자 이름</th>
        <th scope="col" th:text="#{doctors.reservation_list.table.department}">진료과</th>
        <th scope="col" th:text="#{doctors.reservation_list.table.status}">상태</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="res : ${reservations}" class="text-center">
        <td>
          <span class="badge bg-light text-dark fs-6 px-3 py-2" th:text="${res.date}"></span>
        </td>
        <td>
          <span class="text-primary fw-semibold" th:text="${res.time}"></span>
        </td>
        <td>
          <!-- 환자 이름 클릭 시 예약 ID로 medical_certificate 페이지로 이동 -->
          <a th:href="@{/doctors/medical_certificate/{id}(id=${res.id})}" class="text-decoration-none" th:text="${res.user.name}"></a>
        </td>
        <td>
          <span class="badge bg-info text-dark px-3 py-2" th:text="${lang == 'en' ? res.doctor.department.nameEn : res.doctor.department.name}"></span>
        </td>
        <td>
          <!-- 상태에 맞는 텍스트 출력 -->
          <span th:if="${res.state.name() == 'R'}" class="badge bg-warning text-white px-3 py-2" th:text="#{doctors.reservation_list.status.R}">예약중</span>
          <span th:if="${res.state.name() == 'I'}" class="badge bg-primary text-white px-3 py-2" th:text="#{doctors.reservation_list.status.I}">진료중</span>
          <span th:if="${res.state.name() == 'D'}" class="badge bg-success text-white px-3 py-2" th:text="#{doctors.reservation_list.status.D}">완료</span>
          <span th:if="${res.state.name() == 'C'}" class="badge bg-danger text-white px-3 py-2" th:text="#{doctors.reservation_list.status.C}">취소</span>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- 페이징 처리 -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
    <span th:if="${currentPage > 0}">
      <a th:href="@{/doctors/reservationList(page=${currentPage - 1}, size=${size}, searchDate=${searchDate}, searchName=${searchName})}"
         class="btn btn-outline-secondary" th:text="#{doctors.reservation_list.page.prev}">이전</a>
    </span>

      <span th:text="#{doctors.reservation_list.page}">페이지</span> <span th:text="${currentPage + 1}"></span> / <span th:text="${totalPages}"></span>

      <span th:if="${currentPage < totalPages - 1}">
      <a th:href="@{/doctors/reservationList(page=${currentPage + 1}, size=${size}, searchDate=${searchDate}, searchName=${searchName})}"
         class="btn btn-outline-secondary" th:text="#{doctors.reservation_list.page.next}">다음</a>
    </span>
    </div>
  </div>
</div>

<div th:replace="fragments/footer :: footer"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
